<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="../js/3rd/jquery-2.2.3.min.js"></script>
<script type="text/javascript" src="paperjs-v0.9.25/dist/paper-full.js"></script>
<script type="text/paperscript" canvas="Canvas">

	var sequence = [508, 510, 511, 510, 508, 507, 508, 510, 508, 507, 508, 510, 511]; //, 408, 409, 411, 409, 408, 409, 411, 412, 411, 409, 408, 409, 411, 409, 408, 511, 510];
	//sequence = [508, 505, 507, 508, 507, 505, 507, 508, 507, 505];
	//sequence = [112, 113, 114, 115, 117, 118, 119, 120, 101, 102, 103, 104, 113, 112, 114];
	//sequence = [100, 110, 100, 112, 100, 114, 100, 115];
	//sequence = [607, 608, 610, 608, 607, 612, 613, 615, 613, 612, 615, 617, 618, 617, 615];
	//sequence = [411, 412, 413, 414, 417, 418, 419, 420];
	//sequence = [412, 414, 415, 414, 412];
	var uniquesequence = [];

	var interval = [];
	var uniqueinterval = [];

	var startNoteinterval = [];
	var xIndexSeq = [0];

	var flowCostP = 0.20;
	var flowCostN = 0.30;
	var flowCostSum = 0.00;

	var x = 0;
  var xCanvas = 600;
  var SIZE = 20;

	var Xc = new Path.Line({
		from: [0, 600],
		to: [1200, 600],
		strokeColor: 'grey'
	});

	function uniqueBuilder(seq) {
		var f = {},
			i = 0,
			l = seq.length,
			r = [];
		while (i < l) {
			!f[seq[i]] && r.push(seq[i]);
			f[seq[i++]] = 1;
		}
		return r;
	}

	function flowChecker(interval)
	{
		x = x + interval;
		xIndexSeq.push(x);

		xCanvas = 600 + (x * SIZE);
		//console.log("[" + x + "] " + xCanvas);

		//flowCost
		if (interval > 0)
		{
			flowCostSum += parseFloat ( (interval * flowCostP) );
		}
		else if (interval < 0)
		{
			flowCostSum += parseFloat ( ( (-1) * interval * flowCostN) );
		}

    // cycle
		if(x == 0)
		{
			var c1 = new Path.Circle(new Point(xCanvas, 600), 4);
			c1.style = {
				fillColor: '#ddd',
				strokeColor: 'black',
				strokeWidth: 1
			};
		}
		else 
		{
			var c1 = new Path.Circle(new Point(xCanvas, 600), 4);
			c1.style = {
				fillColor: '#ff6060',
				strokeColor: 'black',
				strokeWidth: 1
			};
		}

	}

	if(sequence.length >= 4)
	{

		// generate interval
		var n = 1;
		var p = 0;
		for (var i = 0; i < sequence.length - 1; i++, n++, p++) 
		{
			var itv = sequence[n] - sequence[p];
			interval.push(itv);		
		}

		// Console 
		console.log("sequence: " + sequence + " len: " + sequence.length);
		uniquesequence = uniqueBuilder(sequence);
		console.log("unique sequence: " + uniquesequence + " len: " + uniquesequence.length);

		console.log("interval seq: " + interval + " len: " + interval.length);
		uniqueinterval = uniqueBuilder(interval);
		console.log("unique interval: " + uniqueinterval + " len: " + uniqueinterval.length);
		// Console

		// Root
		var c1 = new Path.Circle(new Point(600, 600), 5);
		c1.style = {
			fillColor: '#green',
			 strokeColor: 'black',
			 strokeWidth: 1
		};

		// calc interval	
		$.each (interval, function (key, interval) {
			flowChecker(interval);		
		});


		// root finger interval from unique seq
		for (var ii = 0; ii < uniquesequence.length - 1; ii++) 
		{
			startNoteinterval.push(uniquesequence[ii + 1] - uniquesequence[0]);
		}

		console.log("startNoteIntval: " + startNoteinterval);
		console.log("xIndexSeq: " + xIndexSeq + " len: " + xIndexSeq.length);
		console.log("----");
		console.log("Cost interval flow (sum): " + flowCostSum.toFixed(2) );

	}

 </script>

</head>
	<body>
		<div><canvas id="Canvas" width="1200" height="1200" style="border:1px solid #ddd;"></canvas></div>
	</body>
</html>
